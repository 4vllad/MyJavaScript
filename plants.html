<html>
<head>
    <style>
        canvas {
            background: grey;
        }
    </style>
</head>

<body>
<canvas id="canvas" width="600" height="600"></canvas>
<p id="test"></p>


<script>
    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    var plantX = 20;
    var plantY = 100;
    var plantWidth = 20;
    var plantHeight = 20;
    var plant = new Image();
    plant.src = "peashooter.png"
    var plantSelected = false;

    var plantrow = 6;
    var plantcolumn = 8;

    var plantBulletX = plantX;
    var plantBulletY = plantY;
    var plantBulletWidth = 15;
    var plantBulletHeight = 15;
    var plantBulletMargin = 20;
    var plantBulletSpeed = 2;
    var plantAnimationSpeed = 1;
    var plantBullet = new Image();
    plantBullet.src = "pea.png";

    var zombieDistance = 600;
    var zombieX = plantX + zombieDistance;
    var zombieY = plantY;
    var zombieWidth = 20;
    var zombieHeight = 20;
    var zombieHealth = 10;
    var zombieSpeed = 0.25;
    var zombie = new Image();
    zombie.src = "zombie.png";

    var sunWidth = 50;
    var sunHeight = 50;
    var sunX = Math.random()*(canvas.width - sunWidth);
    var sunY = -sunHeight;


    var UIX = 0;
    var UIY = 0;
    var UIWidth = canvas.width;
    var UIHeight = canvas.height;

    var counter = 0;

    var sunScore = 0;
    var sun = new Image();
    sun.src = "sun.png";

    function drawPicture(a,b,c){
        let aa = a;
        let bb = b;
        let cc = c;
        ctx.beginPath();
        ctx.drawImage(aa, (UIWidth/8) * bb, (UIHeight/8) * cc, (UIWidth/8), (UIHeight/8));
        ctx.closePath();
    }





    function drawScore() {
            ctx.beginPath();
            ctx.font = "30px Arial";
            ctx.fillStyle = "yellow";
            ctx.fillText("Sun: " + sunScore, 10, 40);
            ctx.closePath();
    }

    function drawSun() {
        if (counter >= 100) {
            ctx.beginPath();
            ctx.fillStyle = "yellow";
            //ctx.fillRect(sunX, sunY, sunWidth, sunHeight);
            ctx.drawImage(sun, sunX, sunY, sunWidth, sunHeight);
            ctx.closePath();
            if (sunY < canvas.height - sunHeight){sunY += 0.5;}

        }
    }

    function drawUI() {
        drawGrid();
        drawPlantMenu();

    }
    
    function drawGrid() {
        ctx.beginPath();
        ctx.strokeRect(UIX, UIY, (UIWidth/8) * 1, UIHeight);
        ctx.strokeRect(UIX, UIY, (UIWidth/8) * 2, UIHeight);
        ctx.strokeRect(UIX, UIY, (UIWidth/8) * 3, UIHeight);
        ctx.strokeRect(UIX, UIY, (UIWidth/8) * 4, UIHeight);
        ctx.strokeRect(UIX, UIY, (UIWidth/8) * 5, UIHeight);
        ctx.strokeRect(UIX, UIY, (UIWidth/8) * 6, UIHeight);
        ctx.strokeRect(UIX, UIY, (UIWidth/8) * 7, UIHeight);
        ctx.strokeRect(UIX, UIY, UIWidth, (UIHeight/8) * 1);
        ctx.strokeRect(UIX, UIY, UIWidth, (UIHeight/8) * 2);
        ctx.strokeRect(UIX, UIY, UIWidth, (UIHeight/8) * 3);
        ctx.strokeRect(UIX, UIY, UIWidth, (UIHeight/8) * 4);
        ctx.strokeRect(UIX, UIY, UIWidth, (UIHeight/8) * 5);
        ctx.strokeRect(UIX, UIY, UIWidth, (UIHeight/8) * 6);
        ctx.strokeRect(UIX, UIY, UIWidth, (UIHeight/8) * 7);
        ctx.closePath();
    }

    function drawPlantMenu() {
        ctx.beginPath();
        ctx.fillStyle = "#63848c";
        ctx.fillRect((UIWidth/8) * 2,UIY,(UIWidth/8) * 1,(UIHeight/8) * 1);
        ctx.drawImage(plant, (UIWidth/8) * 2,UIY,(UIWidth/16) * 1,(UIHeight/16) * 1);
        ctx.font = "30px Arial";
        ctx.fillStyle = "yellow";
        ctx.fillText("100",(UIWidth/8) * 2, (UIHeight/16) * 2 - 10);
        ctx.closePath();
    }
    
    function drawZombie() {
        ctx.beginPath();
        ctx.fillStyle = "#1a8c58";
        ctx.fillRect(zombieX, zombieY, zombieWidth, zombieHeight);
        ctx.drawImage(zombie, zombieX-30, zombieY-45, zombieWidth+45, zombieHeight+75);
        ctx.closePath();
        zombieX -= zombieSpeed;
    }
    
    function checkBulletHit(){
        if (plantBulletX + plantBulletWidth + plantBulletMargin == canvas.width){
            plantBulletX = 10;
        }
        else if (plantBulletX + plantBulletWidth + plantBulletMargin >= zombieX){
            plantBulletX = 10;
            zombieHealth -= 1;
            if (zombieHealth == 0){
                zombieX = zombieDistance;
                zombieHealth = 10;
            }
        }
    }

    function drawBullet() {
        ctx.beginPath();
        ctx.fillStyle = "#138c1b";
        ctx.fillRect(plantBulletX + plantBulletMargin, plantBulletY, plantBulletWidth, plantBulletHeight);
        ctx.drawImage(plantBullet, plantBulletX + plantBulletMargin, plantBulletY, plantBulletWidth, plantBulletHeight);
        ctx.closePath();
        plantBulletX += plantBulletSpeed;
        checkBulletHit();

    }
    
    function drawPlant() {
        ctx.beginPath();
        ctx.fillStyle = "black";
        ctx.fillRect(plantX, plantY, plantWidth, plantHeight);
        ctx.drawImage(plant, plantX-20, plantY-20, plantWidth+40, plantHeight+40);
        //animatePlant();
        ctx.closePath();

    }

    function animatePlant(){
        if (plantHeight == 20){
        plantHeight = -plantAnimationSpeed;
        }
        else if (plantHeight == 10){
            plantHeight = -plantAnimationSpeed;
        }
    }

    document.addEventListener("click", onClickHandler ,false);

    function onClickHandler(e) {
        sunHandler(e);
        plantHandler(e);
        plantPutDownHandler(e);

    }

    function sunHandler(e){
        if (e.clientX >= sunX && e.clientX <= sunX + sunWidth
            && e.clientY >= sunY && e.clientY <= sunY + sunHeight){
            sunY = -sunHeight;
            sunX = Math.random()*(canvas.width - sunWidth);
            sunScore += 25;
        }
    }
    
    function plantHandler(e) {
        if (e.clientX >= (UIWidth/8)*2 && e.clientX <= (UIWidth/8)*2 + (UIWidth/8)
            && e.clientY >= (UIHeight/8)*0 && e.clientY <= (UIHeight/8)*0 + (UIHeight/8) ){
            if(sunScore != 0) {
                sunScore -= 25;
                plantSelected = true;
            }
        }
    }
    
    function plantPutDownHandler(e) {
        if (plantSelected == true){
            plantCurrentNumber += 1;
            plantSelected == false;
        }
    }

    var plantNumber = 0;
    var plantOldNumber = 0;
    function checkPlants(){
        if (plantNumber > plantOldNumber){
            for (let i = 0; plantOldNumber < plantNumber; i++){
            drawPicture(plant,i,i);
            }
        }
    }

    var plantCurrentNumber = 0;
    var plantOldNumber = 0;
    var pX = 0;
    var pY = 0;
    function checkPlants(){
        if (plantCurrentNumber > plantOldNumber){
            drawPicture(plant,pX,pY);
            pX += 40;
            pY += 40;
            plantOldNumber++;
        }
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawUI();
        drawPlant();
        drawBullet();
        drawZombie();
        drawSun();
        drawScore();

        checkPlants();
        document.getElementById("test").innerHTML = "Test: " + plantNumber + " " + plantOldNumber;

        counter++;
    }

    setInterval(draw, 10);



</script>
</body>


</html>